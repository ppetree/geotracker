<?xml version="1.0" encoding="utf-8"?>
<extension type="module" version="3.5" client="site" method="upgrade">
    <name>GeoTracker - Shows The Latest Visitors On A Google Map</name>
    <author>Phil Petree</author>
	<creationDate>November 2023</creationDate>
    <version>1.8.5</version>
	<copyright>Copyright (C) 2023 Phil Petree. All rights reserved.</copyright>
	<license>http://www.gnu.org/licenses/gpl-2.0.html GNU/GPL</license>
    <description><![CDATA[This module shows the latest visitors to your website on a Google Map. To do this, it captures the visitors IP address and uses 
    ip2location.io to retrieve visitors approximate latitude and longitude coordinates and then stores those coordinates a database. 
    A cookie is then saved marking this as 'done' and so we don't duplicate lookups.<br<br>
    To implement this you will need two modules.<br><br><strong>Module One:</strong> In this module 'Show Map' is disabled and 'Hide Title' should be set to NO and then assigned to any module position on all the pages where you want to capture the visitors location (home page, landing pages etc).<br><br>
    <strong>Module Two:</strong>The other module will have 'Show Maps' enabled and this module will be assigned to the page where you want your map displayed. Something like 'geotracker-map'<br><br>
	You will need a free account at ip2location.io (peferred) or ipapi.com (less secure, fewer lookups) plus you will need your Google Maps key.<br<br>
	Lastly, you will probably want to keep the menu item showing this map off the public lookups so that random visitors don't run up your maps usage.]]>
</description>

	<install> <!-- Runs on install -->
		<sql>
			<file driver="mysql" charset="utf8">install.mysql.utf8.sql</file>
		</sql>
	</install>

	<languages>
        <language tag="en-GB">en-GB.mod_geotracker.ini</language>
    </languages>

    <files>
		<filename module="mod_geotracker">mod_geotracker.php</filename>
        <filename>mod_geotracker.xml</filename>       
        <filename>index.php</filename>
		<file>install.mysql.utf8.sql</file>
        <filename>helper.php</filename>
        <folder>tmpl</folder>
		<folder>img</folder>
    </files>

	<config>
		<fields name="params" >
			<fieldset name="basic">
			<field name="showmap" type="radio" default="1" label="Show Map" description="Hiding the map can allow you to keep on recording visitors' location data without showing the map." class="radio btn-group btn-group-yesno">
					<option value="0">Hide Map - Capture Data</option>
					<option value="1">Show Map - Map with Data</option>
			</field>

			<field name="showtext" type="radio" default="0" label="Show Text" description="This only provides minimal text when the map is shown."  class="radio btn-group btn-group-yesno">
					<option value="0">Hide</option>
					<option value="1">Show</option>
			</field>

			<field name="width" type="text" default="100%" label="Map Width" description="Supports both % and px units" />
			<field name="height" type="text" default="400px" label="Map Height" description="Supports both % and px units" />
			<field name="maplatitude" type="text" default="40" label="Default map Latitude" description="Latitude to center on your sceen" />
			<field name="maplongitude" type="text" default="10" label="Default map Longitude" description="Longitude to center on your screen" />
			<field name="zoom" type="list" default="2" label="Default Zoom" description="1 is far, 20 is near. Some views are not available at high values">
					<option value="0">0</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
					<option value="13">13</option>
					<option value="14">14</option>
					<option value="15">15</option>
					<option value="16">16</option>
					<option value="17">17</option>
					<option value="18">18</option>
					<option value="19">19</option>
					<option value="20">20</option>
			</field>

			<field name="minzoom" type="list" default="0" label="Min Zoom" description="">
					<option value="0">0</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
					<option value="13">13</option>
					<option value="14">14</option>
					<option value="15">15</option>
					<option value="16">16</option>
					<option value="17">17</option>
					<option value="18">18</option>
					<option value="19">19</option>
					<option value="20">20</option>
			</field>

			<field name="maxzoom" type="list" default="20" label="Max Zoom" description="">
					<option value="0">0</option>
					<option value="1">1</option>
					<option value="2">2</option>
					<option value="3">3</option>
					<option value="4">4</option>
					<option value="5">5</option>
					<option value="6">6</option>
					<option value="7">7</option>
					<option value="8">8</option>
					<option value="9">9</option>
					<option value="10">10</option>
					<option value="11">11</option>
					<option value="12">12</option>
					<option value="13">13</option>
					<option value="14">14</option>
					<option value="15">15</option>
					<option value="16">16</option>
					<option value="17">17</option>
					<option value="18">18</option>
					<option value="19">19</option>
					<option value="20">20</option>
			</field>

			<field name="scrollwheel" type="radio" default="0" label="Scroll wheel zoom" description="" class="radio btn-group btn-group-yesno">
					<option value="0">disable</option>
					<option value="1">enable</option>
			</field>

			<field name="type" type="list" default="ROADMAP" label="Default map type" description="Select the type of map to draw first (default is Roadmap)" >
				<option value="ROADMAP">Roadmap Map</option>
				<option value="SATELLITE">Satellite Map</option>
				<option value="HYBRID">Hybrid Map</option>
				<option value="TERRAIN">Terrain Map</option>
			</field>

			<field name="stylez" type="textarea" filter="raw" default="" label="Map Custom styling" description="You can customize the map layout colors. Basicaly you need to paste in this field the JSON code you get on nordmograph.com/extensions" />
	 		<field name="limit" type="text" default="100" label="Number of Visitors to show on the map" description="Will show the latest visitors" /> 
		</fieldset>

		<fieldset 
			name="instructions">

    <![CDATA[This module shows the latest visitors to your website on a Google Map. To do this, it captures the visitors IP address and uses 
    ip2location.io to retrieve visitors approximate latitude and longitude coordinates and then stores those coordinates a database. 
    A cookie is then saved marking this as 'done' and so we don't duplicate lookups.<br<br>
    To implement this you will need two modules.<br><br><strong>Module One:</strong> In this module 'Hide Map - Capture Data' should be selected and 'Title' should be set to NO and then assigned to any module position on all the pages where you want to capture the visitors location (home page, landing pages etc).<br><br>
    <strong>Module Two:</strong>This second module will have 'Show Maps' enabled and this module will be assigned to the page where you want your map displayed. Something like 'geotracker-map'<br><br>
	You will need a free account at ip2location.io (peferred) or ipapi.com (less secure, fewer lookups) plus you will need your Google Maps key.<br<br>
	Lastly, you will probably want to keep the menu item showing this map off the public lookups so that random visitors don't run up your maps usage.]]>
		</fieldset>

		<fieldset
			name="advanced">
			<field name="apikey" type="text" default="" size="80" label="Google Maps Api Key" description="Required GoogleMaps API key. Sign up for a free key." />
			<field name="ipservice" type="list" required='required' label="IP Service" description="Select the IP 2 Geo service you want to use" >
				<option value="IPAPI">ipapi.com</option>
				<option value="IP2LOC">ip2location.io</option>
			</field>
			<field name="ipaccess" type="text" default="" size="80" required='required' label="IP Service Access Key" description="Required acess key. Sign up for a free key." />

			<field name="cookie_timeout" type="text" default="7200" label="Cookie timeout duration" description="A cookie is set on the client's machine so that we know we have already got his Geo Location. This will skip replotting the same area for the duration of the cookie. Specify timeout length in seconds. Minimum accepted value is 3600" />
				<field
					name="layout"
					type="modulelayout"
					label="JFIELD_ALT_LAYOUT_LABEL"
					description="JFIELD_ALT_MODULE_LAYOUT_DESC" />

				<field
					name="moduleclass_sfx"
					type="text"
					label="COM_MODULES_FIELD_MODULECLASS_SFX_LABEL"
					description="COM_MODULES_FIELD_MODULECLASS_SFX_DESC" />

				<field
					name="cache"
					type="list"
					default="1"
					label="COM_MODULES_FIELD_CACHING_LABEL"
					description="COM_MODULES_FIELD_CACHING_DESC">
					<option
						value="1">JGLOBAL_USE_GLOBAL</option>
					<option
						value="0">COM_MODULES_FIELD_VALUE_NOCACHING</option>
				</field>

				<field
					name="cache_time"
					type="text"
					default="900"
					label="COM_MODULES_FIELD_CACHE_TIME_LABEL"
					description="COM_MODULES_FIELD_CACHE_TIME_DESC" />
				<field
					name="cachemode"
					type="hidden"
					default="itemid">
					<option
						value="itemid"></option>
				</field>
			</fieldset>
		</fields>
    </config>

	<!-- UPDATESERVER DEFINITION -->
	<updateservers>
		<!-- Note: No spaces or linebreaks allowed between the server tags -->
		<server type="extension" priority="1" name="GeoTracker Update Site">https://raw.githubusercontent.com/ppetree/geotracker/main/update.xml</server>
	</updateservers>

</extension>